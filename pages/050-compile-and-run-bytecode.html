<section>
  <h1>Byte-Compiling Python</h1>

  <span class="small">
    <p>
      <pre style="line-height: 15px; font-size: 0.60em">
      <code class="hljs language-python">"""
BlackHat Asia Example
"""


def five():
    """Returns the string five"""
    return "5"


# Call the function we just defined.
print(five())</code>
    </pre>
  </p>

    <p class="fragment">Byte compile this program:
      <pre class="fragment">
	<code class="hljs language-shell"
	      style="width: 600px;"
	      data-line-numbers="1|1-5">$ python -m compileall five.py
Compiling 'five.py'...
$ ls -l __pycache__/five.cpython-38.pyc
-rw-rw-r-- 1 rocky rocky 301 Feb 17 10:16 __pycache__/five.cpython-38.pyc
      </code>
      </pre>
    </p>

    <div class="fragment">
      <p>I run the bytecode:
      <pre>
	<code class="hljs language-shell" data-trim data-noescape>
$ python /tmp/five-moved.pyc
5</code></pre>
      </p>
      <p>and again I get 5.</p>
    </div>
  </span>

  <aside class="notes">
    <p><div style="color: blue; background-color:
		   LightYellow">#/5
      </div>
      As I said, the interpreter doesn’t run the source text directly,
      but instead runs bytecode. One implication of this, is that the
      source text doesn’t need to exist after byte-code compilation is
      done.
    </p>
    <p>For certain kinds of Python source text, called "modules", the
       internal bytecode is written to disk automatically.</p>
    <p>
      However, we can <em>force</em> the bytecode to get written to
      disk using the Python
      <code>compileall</code> module. <div style="color: blue; background-color:
    LightYellow">[DOWN] #/5 ⟶ #5/0/1 [DOWN]</div> This is the
    invocation. <div style="color: blue; background-color:
    LightYellow">[DOWN] #/5 ⟶ #5/0/1</div>
    </p>

    <p>
      A "bytecode file" is a builtin Python Code object which is
      serialized and then written out a file using a routine called
      "marshal". There is a little extra data added like the
      source-text file name, and bytecode version.
      <div style="color: blue; background-color: LightYellow">[DOWN]
	#/5/0/1 ⟶ #5/0/2
      </div>
    </p>

    <p>The short name of this file here is <em>five dot cpython dash
      38 dot pyc</em>.  That's a mouthful. The file extension of a
      bytecode file usually ends in "dot pyc" as it is here, or "dot
      pyo".
    </p>

    <p>Now that we have this bytecode object, I can run just the
    bytecode. <div style="color: blue; background-color:
    LightYellow">[DOWN] #/5/1 ⟶ #/5/1/0</div>
    </p>

    <p>
      And again, I get 5.
      <div style="color: blue; background-color: LightYellow">[NEXT]
	#5/1/0 ⟶ #/6
      </div>
    </p>

  </aside>
</section>
